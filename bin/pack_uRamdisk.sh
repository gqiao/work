#!/bin/bash

#cd rootfs && find . | cpio -o --format=newc -R root:root | gzip -9 > ../ramdisk.img
#mkimage -A arm -O linux -T ramdisk -C gzip -d ramdisk.img uRamdisk
# ensure it is correctly used
if [ $# -ne 1 ]
then
        cmd=`basename $0`
        echo "Usage: $cmd ramdisk_dir"
        exit 1
fi

# get the work dir
work_dir=`pwd`

# get the ramdisk dir
ramdisk_dir=$1;
if [ ! -d $ramdisk_dir ]
then
        echo "$ramdisk_dir is not existed"
        exit 2
fi

cd $ramdisk_dir && find . | cpio -o --format=newc -R root:root | gzip -9 > ../ramdisk.img
cd $work_dir
mkimage -A arm -O linux -T ramdisk -C gzip -d ramdisk.img uRamdisk
rm ramdisk.img


# archive ramdisk_dir by cpio
#cd $ramdisk_dir
#ramdisk=$work_dir/ramdisk
#find . -depth -print | cpio -o --format=newc -R root:root > $ramdisk
#cd $work_dir

# gzip the archive file ramdisk
#gzip -c -9 $ramdisk > ramdisk.gz
#ramdisk_gz=$work_dir/ramdisk.gz
#rm $ramdisk

# make uRamdisk
#mkimage -A arm -O linux -C gzip -a 0 -e 0 -n 'Execute uImage' -d $ramdisk_gz uRamdisk
#mkimage -A arm -O linux -T ramdisk -C gzip -n 'Generated by pack_uRamdisk.sh' -d $ramdisk_gz uRamdisk
#rm $ramdisk_gz
